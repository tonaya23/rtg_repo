<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RealTimeGantt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">RealTimeGantt</h1>
        
        <div class="bg-white shadow-md rounded-lg p-6">
            <form id="task-form" class="mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="task-name" placeholder="Task Name" 
                           class="input border p-2 rounded" required>
                    <input type="date" id="start-date" 
                           class="input border p-2 rounded" required>
                    <input type="date" id="end-date" 
                           class="input border p-2 rounded" required>
                    <input type="number" id="progress" placeholder="Progress (%)" 
                           min="0" max="100" 
                           class="input border p-2 rounded">
                </div>
                <button type="submit" 
                        class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                    Add Task
                </button>
            </form>

            <table id="tasks-table" class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="p-3 text-left">Task Name</th>
                        <th class="p-3 text-left">Start Date</th>
                        <th class="p-3 text-left">End Date</th>
                        <th class="p-3 text-left">Progress</th>
                        <th class="p-3 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody id="tasks-list"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Pusher Configuration
        const pusher = new Pusher('YOUR_PUSHER_KEY', {
            cluster: 'us2'
        });
        const channel = pusher.subscribe('tasks-channel');

        // Fetch and Display Tasks
        async function fetchTasks() {
            const response = await fetch('/api/tasks');
            const data = await response.json();
            const tasksList = document.getElementById('tasks-list');
            tasksList.innerHTML = '';
            data.data.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="p-3">${task.name}</td>
                    <td class="p-3">${task.start_date}</td>
                    <td class="p-3">${task.end_date}</td>
                    <td class="p-3">${task.progress}%</td>
                    <td class="p-3">
                        <button onclick="editTask(${task.id})" class="text-blue-500 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteTask(${task.id})" class="text-red-500">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tasksList.appendChild(row);
            });
        }

        // Add Task
        document.getElementById('task-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const task = {
                name: document.getElementById('task-name').value,
                start_date: document.getElementById('start-date').value,
                end_date: document.getElementById('end-date').value,
                progress: document.getElementById('progress').value
            };
            await fetch('/api/tasks', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(task)
            });
            e.target.reset();
        });

        // Pusher Event Listeners
        channel.bind('task-created', fetchTasks);
        channel.bind('task-updated', fetchTasks);
        channel.bind('task-deleted', fetchTasks);

        // Initial Tasks Load
        fetchTasks();
    </script>
</body>
</html>